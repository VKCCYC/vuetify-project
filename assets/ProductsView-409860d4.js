import{p as se,aA as pe,aB as he,g as ne,D as Ve,aC as be,aD as Pe,o as E,u as re,aE as xe,aF as ee,c as a,G as $,t as O,aG as we,q as ke,a5 as J,aH as Ce,aI as Se,x as p,s as Fe,H as Be,A as Te,z as j,B as De,aJ as Ie,aK as Re,T as ie,aL as Ae,aM as Me,aN as Ue,aO as He,ai as ae,aP as Ne,v as Ge,y as _e,Y as Ee,$ as $e,a0 as de,a1 as ze,a3 as g,aQ as Oe,ab as qe,J as X,a8 as Z,ap as te,aR as Le,V as je,a2 as Ke,a4 as Je,a7 as m,ao as We,ag as Qe,ac as Ye,aa as Xe,ae as Ze,af as ea,a9 as aa,an as ta,W as la}from"./index-c2adf191.js";import{c as oa,a as le,e as sa,f as na,u as ra,d as K,V as ua}from"./index.esm-2f246ecb.js";import{V as ia}from"./VContainer-ff19c1eb.js";import{a as da,V as oe}from"./VRow-3dd1619d.js";import{V as ca}from"./VDivider-647ff206.js";import{m as va,a as ce,b as ma,c as fa,d as ga,e as pa,f as Va,g as ba,h as xa,u as ya,p as ha,i as Pa,j as wa,k as ka,l as Ca,n as Sa,o as Fa,q as ve,r as me,s as fe,t as ge,v as Ba}from"./VDataTable-e9fa4843.js";import"./VList-630c0240.js";const Ta=se({...pe(),...he(va(),["inline"])},"VCheckbox"),Da=ne()({name:"VCheckbox",inheritAttrs:!1,props:Ta(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,M){let{attrs:F,slots:l}=M;const i=Ve(e,"modelValue"),{isFocused:r,focus:h,blur:H}=be(e),B=Pe(),U=E(()=>e.id||`checkbox-${B}`);return re(()=>{const[z,D]=xe(F),N=ee.filterProps(e),V=ce.filterProps(e);return a(ee,$({class:["v-checkbox",e.class]},z,N,{modelValue:i.value,"onUpdate:modelValue":x=>i.value=x,id:U.value,focused:r.value,style:e.style}),{...l,default:x=>{let{id:y,messagesId:I,isDisabled:P,isReadonly:w}=x;return a(ce,$(V,{id:y.value,"aria-describedby":I.value,disabled:P.value,readonly:w.value},D,{modelValue:i.value,"onUpdate:modelValue":G=>i.value=G,onFocus:h,onBlur:H}),l)}})}),{}}}),Ia=se({itemsLength:{type:[Number,String],required:!0},...ma(),...fa(),...ga()},"VDataTableServer"),Ra=ne()({name:"VDataTableServer",props:Ia(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,M){let{attrs:F,slots:l}=M;const{groupBy:i}=pa(e),{sortBy:r,multiSort:h,mustSort:H}=Va(e),{page:B,itemsPerPage:U}=ba(e),z=E(()=>parseInt(e.itemsLength,10)),{columns:D,headers:N}=xa(e,{groupBy:i,showSelect:O(e,"showSelect"),showExpand:O(e,"showExpand")}),{items:V}=ya(e,D),{toggleSort:x}=ha({sortBy:r,multiSort:h,mustSort:H,page:B}),{opened:y,isGroupOpen:I,toggleGroup:P,extractRows:w}=Pa({groupBy:i,sortBy:r}),{pageCount:G,setItemsPerPage:q}=wa({page:B,itemsPerPage:U,itemsLength:z}),{flatItems:_}=ka(V,i,y),{isSelected:R,select:T,selectAll:A,toggleSelect:k,someSelected:C,allSelected:s}=Ca(e,{allItems:V,currentPage:V}),{isExpanded:b,toggleExpand:d}=Sa(e),c=E(()=>w(V.value));Fa({page:B,itemsPerPage:U,sortBy:r,groupBy:i,search:O(e,"search")}),we("v-data-table",{toggleSort:x,sortBy:r}),ke({VDataTableRows:{hideNoData:O(e,"hideNoData"),noDataText:O(e,"noDataText"),loading:O(e,"loading"),loadingText:O(e,"loadingText")}});const v=E(()=>({page:B.value,itemsPerPage:U.value,sortBy:r.value,pageCount:G.value,toggleSort:x,setItemsPerPage:q,someSelected:C.value,allSelected:s.value,isSelected:R,select:T,selectAll:A,toggleSelect:k,isExpanded:b,toggleExpand:d,isGroupOpen:I,toggleGroup:P,items:c.value.map(u=>u.raw),internalItems:c.value,groupedItems:_.value,columns:D.value,headers:N.value}));re(()=>{const u=ve.filterProps(e),o=me.filterProps(e),f=fe.filterProps(e),t=ge.filterProps(e);return a(ge,$({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},t),{top:()=>{var n;return(n=l.top)==null?void 0:n.call(l,v.value)},default:()=>{var n,S,W,Q,Y,L;return l.default?l.default(v.value):a(J,null,[(n=l.colgroup)==null?void 0:n.call(l,v.value),a("thead",{class:"v-data-table__thead",role:"rowgroup"},[a(me,$(o,{sticky:e.fixedHeader}),l)]),(S=l.thead)==null?void 0:S.call(l,v.value),a("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(W=l["body.prepend"])==null?void 0:W.call(l,v.value),l.body?l.body(v.value):a(fe,$(F,f,{items:_.value}),l),(Q=l["body.append"])==null?void 0:Q.call(l,v.value)]),(Y=l.tbody)==null?void 0:Y.call(l,v.value),(L=l.tfoot)==null?void 0:L.call(l,v.value)])},bottom:()=>l.bottom?l.bottom(v.value):a(ve,u,{prepend:l["footer.prepend"]})})})}});const Aa=se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...pe(),...Ce()},"VTextarea"),Ma=ne()({name:"VTextarea",directives:{Intersect:Se},inheritAttrs:!1,props:Aa(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,M){let{attrs:F,emit:l,slots:i}=M;const r=Ve(e,"modelValue"),{isFocused:h,focus:H,blur:B}=be(e),U=E(()=>typeof e.counterValue=="function"?e.counterValue(r.value):(r.value||"").toString().length),z=E(()=>{if(F.maxlength)return F.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function D(s,b){var d,c;!e.autofocus||!s||(c=(d=b[0].target)==null?void 0:d.focus)==null||c.call(d)}const N=p(),V=p(),x=Fe(""),y=p(),I=E(()=>e.persistentPlaceholder||h.value||e.active);function P(){var s;y.value!==document.activeElement&&((s=y.value)==null||s.focus()),h.value||H()}function w(s){P(),l("click:control",s)}function G(s){l("mousedown:control",s)}function q(s){s.stopPropagation(),P(),ae(()=>{r.value="",Ne(e["onClick:clear"],s)})}function _(s){var d;const b=s.target;if(r.value=b.value,(d=e.modelModifiers)!=null&&d.trim){const c=[b.selectionStart,b.selectionEnd];ae(()=>{b.selectionStart=c[0],b.selectionEnd=c[1]})}}const R=p(),T=p(+e.rows),A=E(()=>["plain","underlined"].includes(e.variant));Be(()=>{e.autoGrow||(T.value=+e.rows)});function k(){e.autoGrow&&ae(()=>{if(!R.value||!V.value)return;const s=getComputedStyle(R.value),b=getComputedStyle(V.value.$el),d=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),c=R.value.scrollHeight,v=parseFloat(s.lineHeight),u=Math.max(parseFloat(e.rows)*v+d,parseFloat(b.getPropertyValue("--v-input-control-height"))),o=parseFloat(e.maxRows)*v+d||1/0,f=_e(c??0,u,o);T.value=Math.floor((f-d)/v),x.value=Ge(f)})}Te(k),j(r,k),j(()=>e.rows,k),j(()=>e.maxRows,k),j(()=>e.density,k);let C;return j(R,s=>{s?(C=new ResizeObserver(k),C.observe(R.value)):C==null||C.disconnect()}),De(()=>{C==null||C.disconnect()}),re(()=>{const s=!!(i.counter||e.counter||e.counterValue),b=!!(s||i.details),[d,c]=xe(F),{modelValue:v,...u}=ee.filterProps(e),o=Ie(e);return a(ee,$({ref:N,modelValue:r.value,"onUpdate:modelValue":f=>r.value=f,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":A.value},e.class],style:e.style},d,u,{centerAffix:T.value===1&&!A.value,focused:h.value}),{...i,default:f=>{let{id:t,isDisabled:n,isDirty:S,isReadonly:W,isValid:Q}=f;return a(Re,$({ref:V,style:{"--v-textarea-control-height":x.value},onClick:w,onMousedown:G,"onClick:clear":q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},o,{id:t.value,active:I.value||S.value,centerAffix:T.value===1&&!A.value,dirty:S.value||e.dirty,disabled:n.value,focused:h.value,error:Q.value===!1}),{...i,default:Y=>{let{props:{class:L,...ue}}=Y;return a(J,null,[e.prefix&&a("span",{class:"v-text-field__prefix"},[e.prefix]),ie(a("textarea",$({ref:y,class:L,value:r.value,onInput:_,autofocus:e.autofocus,readonly:W.value,disabled:n.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:P,onBlur:B},ue,c),null),[[Ae("intersect"),{handler:D},null,{once:!0}]]),e.autoGrow&&ie(a("textarea",{class:[L,"v-textarea__sizer"],id:`${ue.id}-sizer`,"onUpdate:modelValue":ye=>r.value=ye,ref:R,readonly:!0,"aria-hidden":"true"},null),[[Me,r.value]]),e.suffix&&a("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:b?f=>{var t;return a(J,null,[(t=i.details)==null?void 0:t.call(i,f),s&&a(J,null,[a("span",null,null),a(Ue,{active:e.persistentCounter||h.value,value:U.value,max:z.value},i.counter)])])}:void 0})}),He({},N,V,y)}}),Ua=ta("h1",{class:"text-center"},"商品管理",-1),Oa={__name:"ProductsView",setup(e){const{apiAuth:M}=qe(),F=Ee(),l=p(null),i=p(!1),r=p(""),h=u=>{u?(r.value=u._id,V.value.value=u.name,x.value.value=u.price,y.value.value=u.description,I.value.value=u.category,P.value.value=u.sell):r.value="",i.value=!0},H=()=>{i.value=!1,N(),l.value.deleteFileRecord()},B=["衣服","食品","3C","遊戲"],U=oa({name:le().required("缺少商品名稱"),price:sa().typeError("商品價格格式錯誤").required("缺少商品價格").min(0,"商品價格不能小於 0"),description:le().required("缺少商品說明"),category:le().required("缺少商品分類").test("isCategory","商品分類錯誤",u=>B.includes(u)),sell:na()}),{handleSubmit:z,isSubmitting:D,resetForm:N}=ra({validationSchema:U,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),V=K("name"),x=K("price"),y=K("description"),I=K("category"),P=K("sell"),w=p([]),G=p([]),q=z(async u=>{var o,f,t;if(!((o=w.value[0])!=null&&o.error)&&!(r.value===""&&w.value.length===0))try{const n=new FormData;for(const S in u)n.append(S,u[S]);w.value.length>0&&n.append("image",w.value[0].file),r.value===""?await M.post("/products",n):await M.patch("/products/"+r.value,n),F({text:r.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}}),H(),v()}catch(n){console.log(n);const S=((t=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";F({text:S,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}}),_=p(5),R=[{value:5,title:"5"},{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}],T=p([{key:"createdAt",order:"desc"}]),A=p(1),k=p([]),C=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],s=p(!0),b=p(0),d=p(""),c=async()=>{var u,o,f,t;c.value=!0;try{const{data:n}=await M.get("/products/all",{params:{page:A.value,itemsPerPage:_.value,sortBy:((u=T.value[0])==null?void 0:u.key)||"createdAt",sortOrder:((o=T.value[0])==null?void 0:o.order)==="asc"?1:-1,search:d.value}});k.value.splice(0,k.value.length,...n.result.data),b.value=n.result.total}catch(n){console.log(n);const S=((t=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";F({text:S,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}s.value=!1};c();const v=()=>{A.value=1,c()};return(u,o)=>{const f=$e("VueFileAgent");return de(),ze(J,null,[a(ia,null,{default:g(()=>[a(da,null,{default:g(()=>[a(oe,{cols:"12"},{default:g(()=>[Ua]),_:1}),a(ca),a(oe,{cols:"12"},{default:g(()=>[a(X,{color:"green",onClick:o[0]||(o[0]=t=>h())},{default:g(()=>[Z("新增商品")]),_:1})]),_:1}),a(oe,{cols:"12"},{default:g(()=>[a(Ra,{"items-per-page":_.value,"onUpdate:itemsPerPage":[o[2]||(o[2]=t=>_.value=t),c],"sort-by":T.value,"onUpdate:sortBy":[o[3]||(o[3]=t=>T.value=t),c],page:A.value,"onUpdate:page":[o[4]||(o[4]=t=>A.value=t),c],items:k.value,"items-per-page-options":R,headers:C,loading:s.value,"items-length":b.value,search:d.value,hover:""},{top:g(()=>[a(te,{label:"搜尋","append-icon":"mdi-magnify",modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=t=>d.value=t),"onClick:append":v,onKeydown:Le(v,["enter"])},null,8,["modelValue"])]),"item.image":g(({item:t})=>[a(je,{src:t.image,height:"50px"},null,8,["src"])]),"item.sell":g(({item:t})=>[t.sell?(de(),Ke(la,{key:0,icon:"mdi-check"})):Je("",!0)]),"item.edit":g(({item:t})=>[a(X,{icon:"mdi-pencil",variant:"text",color:"pink",onClick:n=>h(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),a(Oe,{modelValue:i.value,"onUpdate:modelValue":o[12]||(o[12]=t=>i.value=t),persistent:"",width:"600px"},{default:g(()=>[a(ua,{disabled:m(D),onSubmit:We(m(q),["prevent"])},{default:g(()=>[a(Qe,null,{default:g(()=>[a(Ye,null,{default:g(()=>[Z(Xe(r.value===""?"新增商品":"編輯商品"),1)]),_:1}),a(Ze,null,{default:g(()=>[a(te,{label:"名稱",modelValue:m(V).value.value,"onUpdate:modelValue":o[5]||(o[5]=t=>m(V).value.value=t),"error-messages":m(V).errorMessage.value},null,8,["modelValue","error-messages"]),a(te,{label:"價格",type:"number",min:"0",modelValue:m(x).value.value,"onUpdate:modelValue":o[6]||(o[6]=t=>m(x).value.value=t),"error-messages":m(x).errorMessage.value},null,8,["modelValue","error-messages"]),a(Ba,{label:"分類",items:B,modelValue:m(I).value.value,"onUpdate:modelValue":o[7]||(o[7]=t=>m(I).value.value=t),"error-messages":m(I).errorMessage.value},null,8,["modelValue","error-messages"]),a(Da,{label:"上架",modelValue:m(P).value.value,"onUpdate:modelValue":o[8]||(o[8]=t=>m(P).value.value=t),"error-messages":m(P).errorMessage.value},null,8,["modelValue","error-messages"]),a(Ma,{label:"說明",modelValue:m(y).value.value,"onUpdate:modelValue":o[9]||(o[9]=t=>m(y).value.value=t),"error-messages":m(y).errorMessage.value},null,8,["modelValue","error-messages"]),a(f,{modelValue:w.value,"onUpdate:modelValue":o[10]||(o[10]=t=>w.value=t),rawModelValue:G.value,"onUpdate:rawModelValue":o[11]||(o[11]=t=>G.value=t),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1MB 大小限制"},"help-text":"選擇檔案或拖曳到這裡","max-files":1,"max-size":"1MB",ref_key:"fileAgent",ref:l},null,8,["modelValue","rawModelValue"])]),_:1}),a(ea,null,{default:g(()=>[a(aa),a(X,{color:"red",disabled:m(D),onClick:H},{default:g(()=>[Z("取消")]),_:1},8,["disabled"]),a(X,{color:"green",type:"submit",loading:m(D)},{default:g(()=>[Z("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};export{Oa as default};
