import{aq as S,X as B,Y as k,Z as C,x as F,A as P,a0 as $,a1 as A,c as a,a3 as s,ar as M,a5 as N,ab as R,an as n,aa as d,V as E,a7 as u,ao as T,ap as U,J as g,a8 as v}from"./index-43059c0f.js";import{c as j,e as D,u as I,d as J,V as L}from"./index.esm-42faef9a.js";import{V as O}from"./VContainer-f827c095.js";import{a as X,V as m}from"./VRow-f1413a1b.js";const Y={style:{"white-space":"pre"}},Z=n("h1",{class:"text-red text-h1"},"已下架",-1),z=n("br",null,null,-1),ee={__name:"ProductView",setup(G){const f=S(),p=B(),{api:h,apiAuth:y}=R(),i=k(),_=C(),t=F({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),V=j({quantity:D().typeError("格式錯誤").required("缺少數量").min(1,"數量最小為 1")}),{isSubmitting:b,handleSubmit:x}=I({validationSchema:V,initialValues:{quantity:1}}),c=J("quantity"),w=x(async r=>{var o,e;if(!_.isLogin){p.push("/login");return}try{const{data:l}=await y.patch("/users/cart",{product:t.value._id,quantity:r.quantity});_.cart=l.result,i({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:2e3,color:"green",location:"bottom"}})}catch(l){console.log(l);const q=((e=(o=l==null?void 0:l.response)==null?void 0:o.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";i({text:q,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}})}});return P(async()=>{var r,o;try{const{data:e}=await h.get("/products/"+f.params.id);t.value._id=e.result._id,t.value.name=e.result.name,t.value.price=e.result.price,t.value.description=e.result.description,t.value.image=e.result.image,t.value.sell=e.result.sell,t.value.category=e.result.category,document.title=`商品 | ${t.value.name}`}catch(e){console.log(e);const l=((o=(r=e==null?void 0:e.response)==null?void 0:r.data)==null?void 0:o.message)||"發生錯誤，請稍後再試";i({text:l,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"bottom"}}),p.push("/")}}),(r,o)=>($(),A(N,null,[a(O,null,{default:s(()=>[a(X,null,{default:s(()=>[a(m,{cols:"12"},{default:s(()=>[n("h1",null,d(t.value.name),1)]),_:1}),a(m,{cols:"12",md:"6"},{default:s(()=>[a(E,{src:t.value.image},null,8,["src"])]),_:1}),a(m,{cols:"12",md:"6"},{default:s(()=>[n("p",null,"$"+d(t.value.price),1),n("p",Y,d(t.value.description),1),a(L,{disabled:u(b),onSubmit:T(u(w),["prevent"])},{default:s(()=>[a(U,{type:"number",min:"0",modelValue:u(c).value.value,"onUpdate:modelValue":o[0]||(o[0]=e=>u(c).value.value=e),"error-messages":u(c).errorMessage.value},null,8,["modelValue","error-messages"]),a(g,{type:"submit","prepend-icon":"mdi-cart"},{default:s(()=>[v("加入購物車")]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(M,{class:"align-center justify-center text-center","model-value":!t.value.sell,persistent:""},{default:s(()=>[Z,z,a(g,{to:"/",color:"green"},{default:s(()=>[v("回首頁")]),_:1})]),_:1},8,["model-value"])],64))}};export{ee as default};
